spool &5;
WITH  OBJ as (
                SELECT  CANTIDAD,
                        ROUND(CANTIDAD -(CANTIDAD* TO_NUMBER(SUBSTR('${LNCEL-PCT}',1,INSTR('${LNCEL-PCT}',',',1,1)-1),'999999.999'))) AV_LOW,
                        ROUND(CANTIDAD +(CANTIDAD* TO_NUMBER(SUBSTR('${LNCEL-PCT}',1,INSTR('${LNCEL-PCT}',',',1,1)-1),'999999.999'))) AV_HI,
                        ROUND(CANTIDAD -(CANTIDAD* TO_NUMBER(SUBSTR('${LNCEL-PCT}',INSTR('${LNCEL-PCT}',',',1,1)+1,INSTR('${LNCEL-PCT}',',',1,2)-INSTR('${LNCEL-PCT}',',',1,1)-1),'999999.999'))) LD_LOW ,
                        ROUND(CANTIDAD +(CANTIDAD* TO_NUMBER(SUBSTR('${LNCEL-PCT}',INSTR('${LNCEL-PCT}',',',1,1)+1,INSTR('${LNCEL-PCT}',',',1,2)-INSTR('${LNCEL-PCT}',',',1,1)-1),'999999.999'))) LD_HI,
                        ROUND(CANTIDAD -(CANTIDAD* TO_NUMBER(SUBSTR('${LNCEL-PCT}',INSTR('${LNCEL-PCT}',',',1,2)+1,INSTR('${LNCEL-PCT}',',',1,3)-INSTR('${LNCEL-PCT}',',',1,2)-1),'999999.999'))) LT_LOW,
                        ROUND(CANTIDAD +(CANTIDAD* TO_NUMBER(SUBSTR('${LNCEL-PCT}',INSTR('${LNCEL-PCT}',',',1,2)+1,INSTR('${LNCEL-PCT}',',',1,3)-INSTR('${LNCEL-PCT}',',',1,2)-1),'999999.999'))) LT_HI,
                        ROUND(CANTIDAD -(CANTIDAD* TO_NUMBER(SUBSTR('${LNCEL-PCT}',INSTR('${LNCEL-PCT}',',',1,3)+1,INSTR('${LNCEL-PCT}',',',1,4)-INSTR('${LNCEL-PCT}',',',1,3)-1),'999999.999'))) PSB_LOW,
                        ROUND(CANTIDAD +(CANTIDAD* TO_NUMBER(SUBSTR('${LNCEL-PCT}',INSTR('${LNCEL-PCT}',',',1,3)+1,INSTR('${LNCEL-PCT}',',',1,4)-INSTR('${LNCEL-PCT}',',',1,3)-1),'999999.999'))) PSB_HI,
                        ROUND(CANTIDAD -(CANTIDAD* TO_NUMBER(SUBSTR('${LNCEL-PCT}',INSTR('${LNCEL-PCT}',',',1,4)+1,INSTR('${LNCEL-PCT}',',',1,5)-INSTR('${LNCEL-PCT}',',',1,4)-1),'999999.999'))) QDL_LOW,
                        ROUND(CANTIDAD +(CANTIDAD* TO_NUMBER(SUBSTR('${LNCEL-PCT}',INSTR('${LNCEL-PCT}',',',1,4)+1,INSTR('${LNCEL-PCT}',',',1,5)-INSTR('${LNCEL-PCT}',',',1,4)-1),'999999.999'))) QDL_HI,
                        ROUND(CANTIDAD -(CANTIDAD* TO_NUMBER(SUBSTR('${LNCEL-PCT}',INSTR('${LNCEL-PCT}',',',1,5)+1,INSTR('${LNCEL-PCT}',',',1,6)-INSTR('${LNCEL-PCT}',',',1,5)-1),'999999.999'))) QUL_LOW,
                        ROUND(CANTIDAD +(CANTIDAD* TO_NUMBER(SUBSTR('${LNCEL-PCT}',INSTR('${LNCEL-PCT}',',',1,5)+1,INSTR('${LNCEL-PCT}',',',1,6)-INSTR('${LNCEL-PCT}',',',1,5)-1),'999999.999'))) QUL_HI,
                        ROUND(CANTIDAD -(CANTIDAD* TO_NUMBER(SUBSTR('${LNCEL-PCT}',INSTR('${LNCEL-PCT}',',',1,6)+1,INSTR('${LNCEL-PCT}',',',1,7)-INSTR('${LNCEL-PCT}',',',1,6)-1),'999999.999'))) RC_LOW,
                        ROUND(CANTIDAD +(CANTIDAD* TO_NUMBER(SUBSTR('${LNCEL-PCT}',INSTR('${LNCEL-PCT}',',',1,6)+1,INSTR('${LNCEL-PCT}',',',1,7)-INSTR('${LNCEL-PCT}',',',1,6)-1),'999999.999'))) RC_HI,
                        ROUND(CANTIDAD -(CANTIDAD* TO_NUMBER(SUBSTR('${LNCEL-PCT}',INSTR('${LNCEL-PCT}',',',1,7)+1),'999999.999'))) EST_LOW,
                        ROUND(CANTIDAD +(CANTIDAD* TO_NUMBER(SUBSTR('${LNCEL-PCT}',INSTR('${LNCEL-PCT}',',',1,7)+1),'999999.999'))) EST_HI
                FROM  (
                      SELECT /*+ materialize */ COUNT(DISTINCT ELEMENT_NAME) CANTIDAD
                      FROM MULTIVENDOR_OBJECT2
                      WHERE ELEMENT_CLASS = 'LNCEL'
                      AND VALID_FINISH_DATE > SYSDATE
                      AND OSSRC = '${OSSRC}'
                      )),
      RFC as  (
                SELECT /*+ materialize */ FECHA
                FROM CALIDAD_STATUS_REFERENCES
                WHERE FECHA BETWEEN TO_DATE('${FECHA_DESDE}', 'DD.MM.YYYY')
                AND TO_DATE('${FECHA_HASTA}', 'DD.MM.YYYY') + 86399/86400
              ),
       AV as  (
                SELECT /*+ materialize */ TRUNC(R.PERIOD_START_TIME, 'HH24') FECHA, COUNT(*) CANTIDAD
                FROM NOKLTE_PS_LCELAV_MNC1_RAW r
                WHERE r.PERIOD_START_TIME BETWEEN TO_DATE('${FECHA_DESDE}', 'DD.MM.YYYY')
                AND TO_DATE('${FECHA_HASTA}', 'DD.MM.YYYY') + 86399/86400 
                AND OSSRC = '${OSSRC}'
                GROUP BY TRUNC(R.PERIOD_START_TIME, 'HH24')
              ),
      LD  as  (
                SELECT /*+ materialize */ TRUNC(R.PERIOD_START_TIME, 'HH24') FECHA, COUNT(*) CANTIDAD
                FROM NOKLTE_PS_LCELLD_MNC1_RAW r
                WHERE r.PERIOD_START_TIME BETWEEN TO_DATE('${FECHA_DESDE}', 'DD.MM.YYYY')
                AND TO_DATE('${FECHA_HASTA}', 'DD.MM.YYYY') + 86399/86400
                AND OSSRC = '${OSSRC}'
                GROUP BY TRUNC(R.PERIOD_START_TIME, 'HH24')
              ),
      LT  as  (
                SELECT /*+ materialize */ TRUNC(R.PERIOD_START_TIME, 'HH24') FECHA, COUNT(*) CANTIDAD
                FROM NOKLTE_PS_LCELLT_MNC1_RAW R
                WHERE R.PERIOD_START_TIME BETWEEN TO_DATE('${FECHA_DESDE}', 'DD.MM.YYYY')
                AND TO_DATE('${FECHA_HASTA}', 'DD.MM.YYYY') + 86399/86400
                AND OSSRC = '${OSSRC}'
                GROUP BY TRUNC(R.PERIOD_START_TIME, 'HH24')
              ),
      PSB as  (
                SELECT /*+ materialize */ TRUNC(R.PERIOD_START_TIME, 'HH24') FECHA, COUNT(*) CANTIDAD
                FROM NOKLTE_PS_LEPSB_MNC1_RAW r
                WHERE r.PERIOD_START_TIME BETWEEN TO_DATE('${FECHA_DESDE}', 'DD.MM.YYYY')
                AND TO_DATE('${FECHA_HASTA}', 'DD.MM.YYYY') + 86399/86400
                AND OSSRC = '${OSSRC}'
                GROUP BY TRUNC(R.PERIOD_START_TIME, 'HH24')
              ),
      QDL as  (
                SELECT /*+ materialize */ TRUNC(R.PERIOD_START_TIME, 'HH24') FECHA, COUNT(*) CANTIDAD
                FROM NOKLTE_PS_LPQDL_MNC1_RAW r
                WHERE r.PERIOD_START_TIME BETWEEN TO_DATE('${FECHA_DESDE}', 'DD.MM.YYYY')
                AND TO_DATE('${FECHA_HASTA}', 'DD.MM.YYYY') + 86399/86400
                AND OSSRC = '${OSSRC}'
                GROUP BY TRUNC(R.PERIOD_START_TIME, 'HH24')
              ),
      QUL as  (
                SELECT /*+ materialize */ TRUNC(R.PERIOD_START_TIME, 'HH24') FECHA, COUNT(*) CANTIDAD
                FROM NOKLTE_PS_LPQUL_MNC1_RAW r
                WHERE r.PERIOD_START_TIME BETWEEN TO_DATE('${FECHA_DESDE}', 'DD.MM.YYYY')
                AND TO_DATE('${FECHA_HASTA}', 'DD.MM.YYYY') + 86399/86400
                AND OSSRC = '${OSSRC}'
                GROUP BY TRUNC(R.PERIOD_START_TIME, 'HH24')
              ),
      RC  as  (
                SELECT /*+ materialize */ TRUNC(R.PERIOD_START_TIME, 'HH24') FECHA, COUNT(*) CANTIDAD
                FROM NOKLTE_PS_LRRC_MNC1_RAW r
                WHERE r.PERIOD_START_TIME BETWEEN TO_DATE('${FECHA_DESDE}', 'DD.MM.YYYY')
                AND TO_DATE('${FECHA_HASTA}', 'DD.MM.YYYY') + 86399/86400
                AND OSSRC = '${OSSRC}'
                GROUP BY TRUNC(R.PERIOD_START_TIME, 'HH24')
              ),
      EST as  (
                SELECT /*+ materialize */ TRUNC(R.PERIOD_START_TIME, 'HH24') FECHA, COUNT(*) CANTIDAD
                FROM NOKLTE_PS_LUEST_MNC1_RAW r
                WHERE r.PERIOD_START_TIME BETWEEN TO_DATE('${FECHA_DESDE}', 'DD.MM.YYYY')
                AND TO_DATE('${FECHA_HASTA}', 'DD.MM.YYYY') + 86399/86400
                AND OSSRC = '${OSSRC}'
                GROUP BY TRUNC(R.PERIOD_START_TIME, 'HH24')
              )
select	chr(38)||'lt;tr'||CHR(38)||'gt;'||
		chr(38)||'lt;th'||CHR(38)||'gt;'||FECHA||chr(38)||'lt;/th'||CHR(38)||'gt;'||
		chr(38)||'lt;th'||CHR(38)||'gt;'||OSSRC||chr(38)||'lt;/th'||CHR(38)||'gt;'||
		chr(38)||'lt;th'||CHR(38)||'gt;'||CANTIDAD||chr(38)||'lt;/th'||CHR(38)||'gt;'||
		chr(38)||'lt;th'||CHR(38)||'gt;'||AV_CNT||chr(38)||'lt;/th'||CHR(38)||'gt;'||
		chr(38)||'lt;th'||CHR(38)||'gt;'||LD_CNT||chr(38)||'lt;/th'||CHR(38)||'gt;'||
		chr(38)||'lt;th'||CHR(38)||'gt;'||LT_CNT||chr(38)||'lt;/th'||CHR(38)||'gt;'||
		chr(38)||'lt;th'||CHR(38)||'gt;'||PSB_CNT||chr(38)||'lt;/th'||CHR(38)||'gt;'||
		chr(38)||'lt;th'||CHR(38)||'gt;'||QDL_CNT||chr(38)||'lt;/th'||CHR(38)||'gt;'||
		chr(38)||'lt;th'||CHR(38)||'gt;'||QUL_CNT||chr(38)||'lt;/th'||CHR(38)||'gt;'||
		chr(38)||'lt;th'||CHR(38)||'gt;'||RC_CNT||chr(38)||'lt;/th'||CHR(38)||'gt;'||
		chr(38)||'lt;th'||CHR(38)||'gt;'||EST_CNT||chr(38)||'lt;/th'||CHR(38)||'gt;'||
	chr(38)||'lt;/tr'||CHR(38)||'gt;'
from	dual
select  chr(38)||'lt;tr'||CHR(38)||'gt;'||
		chr(38)||'lt;th'||CHR(38)||'gt;'||to_char(sysdate-1,'dd.mm.yyyy')||chr(38)||'lt;/th'||CHR(38)||'gt;'||
		chr(38)||'lt;th'||CHR(38)||'gt;'||null||chr(38)||'lt;/th'||CHR(38)||'gt;'||
		chr(38)||'lt;th'||CHR(38)||'gt;'||null||chr(38)||'lt;/th'||CHR(38)||'gt;'||
		chr(38)||'lt;th'||CHR(38)||'gt;'||to_char(OBJ.AV_LOW)||' <-> '||to_char(OBJ.AV_HI)||chr(38)||'lt;/th'||CHR(38)||'gt;'||
		chr(38)||'lt;th'||CHR(38)||'gt;'||to_char(OBJ.LD_LOW)||' <-> '||to_char(OBJ.LD_HI)||chr(38)||'lt;/th'||CHR(38)||'gt;'||
		chr(38)||'lt;th'||CHR(38)||'gt;'||to_char(OBJ.LT_LOW)||' <-> '||to_char(OBJ.LT_HI)||chr(38)||'lt;/th'||CHR(38)||'gt;'||
		chr(38)||'lt;th'||CHR(38)||'gt;'||to_char(OBJ.PSB_LOW)||' <-> '||to_char(OBJ.PSB_HI)||chr(38)||'lt;/th'||CHR(38)||'gt;'||
		chr(38)||'lt;th'||CHR(38)||'gt;'||to_char(OBJ.QDL_LOW)||' <-> '||to_char(OBJ.QDL_HI)||chr(38)||'lt;/th'||CHR(38)||'gt;'||
		chr(38)||'lt;th'||CHR(38)||'gt;'||to_char(OBJ.QUL_LOW)||' <-> '||to_char(OBJ.QUL_HI)||chr(38)||'lt;/th'||CHR(38)||'gt;'||
		chr(38)||'lt;th'||CHR(38)||'gt;'||to_char(OBJ.RC_LOW)||' <-> '||to_char(OBJ.RC_HI)||chr(38)||'lt;/th'||CHR(38)||'gt;'||
		chr(38)||'lt;th'||CHR(38)||'gt;'||to_char(OBJ.EST_LOW)||' <-> '||to_char(OBJ.EST_HI)||chr(38)||'lt;/th'||CHR(38)||'gt;'|| 
	chr(38)||'lt;/tr'||CHR(38)||'gt;'
from OBJ
union
SELECT  chr(38)||'lt;tr'||CHR(38)||'gt;'||
		chr(38)||'lt;td'||CHR(38)||'gt;'||to_char(RFC.FECHA,'dd.mm.yyyy HH24')||chr(38)||'lt;/td'||CHR(38)||'gt;'||-- FECHA,
		chr(38)||'lt;td'||CHR(38)||'gt;'||'${OSSRC}'||chr(38)||'lt;/td'||CHR(38)||'gt;'||-- OSSRC,
		chr(38)||'lt;td'||CHR(38)||'gt;'||to_char(OBJ.CANTIDAD)||chr(38)||'lt;/td'||CHR(38)||'gt;'||-- CANTIDAD,
		chr(38)||'lt;td'||CHR(38)||'gt;'||
			case  
			    when AV.CANTIDAD is null then
				chr(38)||'lt;'|| 'strong'||CHR(38)||'gt;'|| chr(38)||'lt;'|| 'font color="red"'||CHR(38)||'gt;'
				|| ' S/VALOR '
				||CHR(38)||'lt;'||'/font'||chr(38)||'gt;'||CHR(38)||'lt;'||'/strong'||CHR(38)||'gt;'
			    when AV.CANTIDAD = 0 then
				 to_char(AV.CANTIDAD)
			    when AV.CANTIDAD not between OBJ.AV_LOW and OBJ.AV_HI then
				chr(38)||'lt;'|| 'strong'||CHR(38)||'gt;'|| chr(38)||'lt;'|| 'font color="red"'||CHR(38)||'gt;'
				|| to_char(AV.CANTIDAD)
				||CHR(38)||'lt;'||'/font'||chr(38)||'gt;'||CHR(38)||'lt;'||'/strong'||CHR(38)||'gt;'
			    when AV.CANTIDAD >= ((OBJ.CANTIDAD)*90) /100 then
				chr(38)||'lt;'|| 'strong'||CHR(38)||'gt;'|| chr(38)||'lt;'|| 'font color="green"'||CHR(38)||'gt;'
				|| to_char(AV.CANTIDAD)
				||CHR(38)||'lt;'||'/font'||chr(38)||'gt;'||CHR(38)||'lt;'||'/strong'||CHR(38)||'gt;'
			    else 
				chr(38)||'lt;'|| 'strong'||CHR(38)||'gt;'|| chr(38)||'lt;'|| 'font color="red"'||CHR(38)||'gt;'
				|| to_char(AV.CANTIDAD)
				||CHR(38)||'lt;'||'/font'||chr(38)||'gt;'||CHR(38)||'lt;'||'/strong'||CHR(38)||'gt;' --valor de retorno si todo anda ok
			end ||--AV_CNT,
		chr(38)||'lt;/td'||CHR(38)||'gt;'||
		chr(38)||'lt;td'||CHR(38)||'gt;'||
			case  
			    when LD.CANTIDAD is null then
				chr(38)||'lt;'|| 'strong'||CHR(38)||'gt;'|| chr(38)||'lt;'|| 'font color="red"'||CHR(38)||'gt;'
				|| ' S/VALOR '
				||CHR(38)||'lt;'||'/font'||chr(38)||'gt;'||CHR(38)||'lt;'||'/strong'||CHR(38)||'gt;'
			    when LD.CANTIDAD = 0 then
				to_char(LD.CANTIDAD)
			    when LD.CANTIDAD not between OBJ.LD_LOW and OBJ.LD_HI then
				chr(38)||'lt;'|| 'strong'||CHR(38)||'gt;'|| chr(38)||'lt;'|| 'font color="red"'||CHR(38)||'gt;'
				|| to_char(LD.CANTIDAD)
				||CHR(38)||'lt;'||'/font'||chr(38)||'gt;'||CHR(38)||'lt;'||'/strong'||CHR(38)||'gt;'
			    when LD.CANTIDAD >= ((OBJ.CANTIDAD)*90) /100 then
				chr(38)||'lt;'|| 'strong'||CHR(38)||'gt;'|| chr(38)||'lt;'|| 'font color="green"'||CHR(38)||'gt;'
				|| to_char(LD.CANTIDAD)
				||CHR(38)||'lt;'||'/font'||chr(38)||'gt;'||CHR(38)||'lt;'||'/strong'||CHR(38)||'gt;'          
			    else 
				chr(38)||'lt;'|| 'strong'||CHR(38)||'gt;'|| chr(38)||'lt;'|| 'font color="red"'||CHR(38)||'gt;'
				||to_char(LD.CANTIDAD)
				||CHR(38)||'lt;'||'/font'||chr(38)||'gt;'||CHR(38)||'lt;'||'/strong'||CHR(38)||'gt;' --valor de retorno si todo anda ok
			end ||--LD_CNT,
		chr(38)||'lt;/td'||CHR(38)||'gt;'||
		chr(38)||'lt;td'||CHR(38)||'gt;'||
			case  
			    when LT.CANTIDAD is null then
				chr(38)||'lt;'|| 'strong'||CHR(38)||'gt;'|| chr(38)||'lt;'|| 'font color="red"'||CHR(38)||'gt;'
				|| ' S/VALOR '
				||CHR(38)||'lt;'||'/font'||chr(38)||'gt;'||CHR(38)||'lt;'||'/strong'||CHR(38)||'gt;'
			    when LT.CANTIDAD = 0 then
				to_char(LT.CANTIDAD)
			    when LT.CANTIDAD not between OBJ.LT_LOW and OBJ.LT_HI then
				chr(38)||'lt;'|| 'strong'||CHR(38)||'gt;'|| chr(38)||'lt;'|| 'font color="red"'||CHR(38)||'gt;'
				|| to_char(LT.CANTIDAD)
				||CHR(38)||'lt;'||'/font'||chr(38)||'gt;'||CHR(38)||'lt;'||'/strong'||CHR(38)||'gt;'
			     when LT.CANTIDAD >= ((OBJ.CANTIDAD)*90) /100 then
				chr(38)||'lt;'|| 'strong'||CHR(38)||'gt;'|| chr(38)||'lt;'|| 'font color="green"'||CHR(38)||'gt;'
				|| to_char(LT.CANTIDAD)
				||CHR(38)||'lt;'||'/font'||chr(38)||'gt;'||CHR(38)||'lt;'||'/strong'||CHR(38)||'gt;'         
			    else 
				chr(38)||'lt;'|| 'strong'||CHR(38)||'gt;'|| chr(38)||'lt;'|| 'font color="red"'||CHR(38)||'gt;'
				||to_char(LT.CANTIDAD)
				||CHR(38)||'lt;'||'/font'||chr(38)||'gt;'||CHR(38)||'lt;'||'/strong'||CHR(38)||'gt;' --valor de retorno si todo anda ok
			end ||--LT_CNT,
		chr(38)||'lt;/td'||CHR(38)||'gt;'||
		chr(38)||'lt;td'||CHR(38)||'gt;'||
			case  
			    when PSB.CANTIDAD is null then
				chr(38)||'lt;'|| 'strong'||CHR(38)||'gt;'|| chr(38)||'lt;'|| 'font color="red"'||CHR(38)||'gt;'
				|| ' S/VALOR '
				||CHR(38)||'lt;'||'/font'||chr(38)||'gt;'||CHR(38)||'lt;'||'/strong'||CHR(38)||'gt;'
			    when PSB.CANTIDAD = 0 then
				to_char(PSB.CANTIDAD)
			    when PSB.CANTIDAD not between OBJ.PSB_LOW and OBJ.PSB_HI then
				chr(38)||'lt;'|| 'strong'||CHR(38)||'gt;'|| chr(38)||'lt;'|| 'font color="red"'||CHR(38)||'gt;'
				|| to_char(PSB.CANTIDAD)
				||CHR(38)||'lt;'||'/font'||chr(38)||'gt;'||CHR(38)||'lt;'||'/strong'||CHR(38)||'gt;'
			    when PSB.CANTIDAD >= ((OBJ.CANTIDAD)*90) /100 then
				chr(38)||'lt;'|| 'strong'||CHR(38)||'gt;'|| chr(38)||'lt;'|| 'font color="green"'||CHR(38)||'gt;'
				|| to_char(PSB.CANTIDAD)
				||CHR(38)||'lt;'||'/font'||chr(38)||'gt;'||CHR(38)||'lt;'||'/strong'||CHR(38)||'gt;'         
			    else 
				chr(38)||'lt;'|| 'strong'||CHR(38)||'gt;'|| chr(38)||'lt;'|| 'font color="red"'||CHR(38)||'gt;'
				||to_char(PSB.CANTIDAD)
				||CHR(38)||'lt;'||'/font'||chr(38)||'gt;'||CHR(38)||'lt;'||'/strong'||CHR(38)||'gt;' --valor de retorno si todo anda ok
			end ||--PSB_CNT,
		chr(38)||'lt;/td'||CHR(38)||'gt;'||
		chr(38)||'lt;td'||CHR(38)||'gt;'||
			case  
			    when QDL.CANTIDAD is null then
				chr(38)||'lt;'|| 'strong'||CHR(38)||'gt;'|| chr(38)||'lt;'|| 'font color="red"'||CHR(38)||'gt;'
				|| ' S/VALOR '
				||CHR(38)||'lt;'||'/font'||chr(38)||'gt;'||CHR(38)||'lt;'||'/strong'||CHR(38)||'gt;'
			    when QDL.CANTIDAD = 0 then 
				to_char(QDL.CANTIDAD)
			    when QDL.CANTIDAD not between OBJ.QDL_LOW and QDL_HI then
				chr(38)||'lt;'|| 'strong'||CHR(38)||'gt;'|| chr(38)||'lt;'|| 'font color="red"'||CHR(38)||'gt;'
				|| to_char(QDL.CANTIDAD)
				||CHR(38)||'lt;'||'/font'||chr(38)||'gt;'||CHR(38)||'lt;'||'/strong'||CHR(38)||'gt;'
			    when QDL.CANTIDAD >= ((OBJ.CANTIDAD)*90) /100 then
				chr(38)||'lt;'|| 'strong'||CHR(38)||'gt;'|| chr(38)||'lt;'|| 'font color="green"'||CHR(38)||'gt;'
				|| to_char(QDL.CANTIDAD)
				||CHR(38)||'lt;'||'/font'||chr(38)||'gt;'||CHR(38)||'lt;'||'/strong'||CHR(38)||'gt;'         
			    else 
				chr(38)||'lt;'|| 'strong'||CHR(38)||'gt;'|| chr(38)||'lt;'|| 'font color="red"'||CHR(38)||'gt;'
				||to_char(QDL.CANTIDAD)
				||CHR(38)||'lt;'||'/font'||chr(38)||'gt;'||CHR(38)||'lt;'||'/strong'||CHR(38)||'gt;' --valor de retorno si todo anda ok
			end ||--QDL_CNT,
		chr(38)||'lt;/td'||CHR(38)||'gt;'||
		chr(38)||'lt;td'||CHR(38)||'gt;'||
			case  
			    when QUL.CANTIDAD is null then
				chr(38)||'lt;'|| 'strong'||CHR(38)||'gt;'|| chr(38)||'lt;'|| 'font color="red"'||CHR(38)||'gt;'
				|| ' S/VALOR '
				||CHR(38)||'lt;'||'/font'||chr(38)||'gt;'||CHR(38)||'lt;'||'/strong'||CHR(38)||'gt;'
			    when QUL.CANTIDAD = 0 then
				to_char(QUL.CANTIDAD)
			    when QUL.CANTIDAD not between OBJ.QUL_LOW and OBJ.QUL_HI then
				chr(38)||'lt;'|| 'strong'||CHR(38)||'gt;'|| chr(38)||'lt;'|| 'font color="red"'||CHR(38)||'gt;'
				|| to_char(QUL.CANTIDAD)
				||CHR(38)||'lt;'||'/font'||chr(38)||'gt;'||CHR(38)||'lt;'||'/strong'||CHR(38)||'gt;'
			    when QUL.CANTIDAD >= ((OBJ.CANTIDAD)*90) /100 then
				chr(38)||'lt;'|| 'strong'||CHR(38)||'gt;'|| chr(38)||'lt;'|| 'font color="green"'||CHR(38)||'gt;'
				|| to_char(QUL.CANTIDAD)
				||CHR(38)||'lt;'||'/font'||chr(38)||'gt;'||CHR(38)||'lt;'||'/strong'||CHR(38)||'gt;'         
			    else 
				chr(38)||'lt;'|| 'strong'||CHR(38)||'gt;'|| chr(38)||'lt;'|| 'font color="red"'||CHR(38)||'gt;'
				||to_char(QUL.CANTIDAD)
				||CHR(38)||'lt;'||'/font'||chr(38)||'gt;'||CHR(38)||'lt;'||'/strong'||CHR(38)||'gt;' --valor de retorno si todo anda ok
			end ||-- QUL_CNT,
		chr(38)||'lt;/td'||CHR(38)||'gt;'||
		chr(38)||'lt;td'||CHR(38)||'gt;'||
			case  
			    when RC.CANTIDAD is null then
				chr(38)||'lt;'|| 'strong'||CHR(38)||'gt;'|| chr(38)||'lt;'|| 'font color="red"'||CHR(38)||'gt;'
				|| ' S/VALOR '
				||CHR(38)||'lt;'||'/font'||chr(38)||'gt;'||CHR(38)||'lt;'||'/strong'||CHR(38)||'gt;'
			    when RC.CANTIDAD = 0 then
				to_char(RC.CANTIDAD)
			    when RC.CANTIDAD not between OBJ.RC_LOW and OBJ.RC_HI then
				chr(38)||'lt;'|| 'strong'||CHR(38)||'gt;'|| chr(38)||'lt;'|| 'font color="red"'||CHR(38)||'gt;'
				|| to_char(RC.CANTIDAD)
				||CHR(38)||'lt;'||'/font'||chr(38)||'gt;'||CHR(38)||'lt;'||'/strong'||CHR(38)||'gt;'
			    when RC.CANTIDAD >= ((OBJ.CANTIDAD)*90) /100 then -- cantidad mayor o igual al 90% de la cantidad total
				chr(38)||'lt;'|| 'strong'||CHR(38)||'gt;'|| chr(38)||'lt;'|| 'font color="green"'||CHR(38)||'gt;'
				|| to_char(RC.CANTIDAD)
				||CHR(38)||'lt;'||'/font'||chr(38)||'gt;'||CHR(38)||'lt;'||'/strong'||CHR(38)||'gt;'         
			    else 
				chr(38)||'lt;'|| 'strong'||CHR(38)||'gt;'|| chr(38)||'lt;'|| 'font color="red"'||CHR(38)||'gt;'
				||to_char(RC.CANTIDAD)
				||CHR(38)||'lt;'||'/font'||chr(38)||'gt;'||CHR(38)||'lt;'||'/strong'||CHR(38)||'gt;' --valor de retorno si todo anda ok
			end ||-- RC_CNT,
		chr(38)||'lt;/td'||CHR(38)||'gt;'||
		chr(38)||'lt;td'||CHR(38)||'gt;'||
			case  
			    when EST.CANTIDAD is null then
				chr(38)||'lt;'|| 'strong'||CHR(38)||'gt;'|| chr(38)||'lt;'|| 'font color="red"'||CHR(38)||'gt;'
				|| ' S/VALOR '
				||CHR(38)||'lt;'||'/font'||chr(38)||'gt;'||CHR(38)||'lt;'||'/strong'||CHR(38)||'gt;'
			    when EST.CANTIDAD = 0 then
				      to_char(EST.CANTIDAD)
			    when EST.CANTIDAD not between OBJ.EST_LOW and OBJ.EST_HI then
				chr(38)||'lt;'|| 'strong'||CHR(38)||'gt;'|| chr(38)||'lt;'|| 'font color="red"'||CHR(38)||'gt;'
				|| to_char(EST.CANTIDAD)
				||CHR(38)||'lt;'||'/font'||chr(38)||'gt;'||CHR(38)||'lt;'||'/strong'||CHR(38)||'gt;'
			    when EST.CANTIDAD >= ((OBJ.CANTIDAD)*90) /100 then -- cantidad mayor o igual al 90% de la cantidad total
				chr(38)||'lt;'|| 'strong'||CHR(38)||'gt;'|| chr(38)||'lt;'|| 'font color="green"'||CHR(38)||'gt;'
				|| to_char(EST.CANTIDAD)
				||CHR(38)||'lt;'||'/font'||chr(38)||'gt;'||CHR(38)||'lt;'||'/strong'||CHR(38)||'gt;'       
			    else 
				chr(38)||'lt;'|| 'strong'||CHR(38)||'gt;'|| chr(38)||'lt;'|| 'font color="red"'||CHR(38)||'gt;'
				||to_char(EST.CANTIDAD)
				||CHR(38)||'lt;'||'/font'||chr(38)||'gt;'||CHR(38)||'lt;'||'/strong'||CHR(38)||'gt;' --valor de retorno si todo anda ok
			end ||--EST_CNT
		chr(38)||'lt;/td'||CHR(38)||'gt;'||
	chr(38)||'lt;/tr'||CHR(38)||'gt;'
FROM  OBJ,
      RFC,
      AV,
      LD,
      LT,
      PSB,
      QDL,
      QUL,
      RC,
      EST
WHERE RFC.FECHA = AV.FECHA (+)
AND RFC.FECHA = LD.FECHA (+)
AND RFC.FECHA = LT.FECHA (+)
AND RFC.FECHA = PSB.FECHA (+)
AND RFC.FECHA = QDL.FECHA (+)
AND RFC.FECHA = QUL.FECHA (+)
AND RFC.FECHA = RC.FECHA (+)
AND RFC.FECHA = EST.FECHA (+)
ORDER BY FECHA;
SPOOL OFF
EXIT;
